# ü§ñ Legion

> **–ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –ª–µ–≥–∏–æ–Ω–∞ –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤**

[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Supabase](https://img.shields.io/badge/Supabase-Ready-green)](https://supabase.com)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

Legion - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –Ω–∞ Python, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤. –ü—Ä–æ–µ–∫—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Supabase –¥–ª—è –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ Edge Functions –¥–ª—è —Å–µ—Ä–≤–µ—Ä–ª–µ—Å—Å-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á** - –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async/await
- üóÑÔ∏è **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase** - –æ–±–ª–∞—á–Ω–∞—è PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚ö° **Edge Functions** - —Å–µ—Ä–≤–µ—Ä–ª–µ—Å—Å-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Supabase Functions
- üìä **Task Queue** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∑–∞–¥–∞—á
- üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≥–µ–Ω—Ç–æ–≤** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üéØ **–ì–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≥–µ–Ω—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Legion/
‚îú‚îÄ‚îÄ src/legion/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ core.py           # LegionCore - –≥–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ agents.py         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å LegionAgent
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
‚îÇ   ‚îî‚îÄ‚îÄ queue.py          # TaskQueue –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏
‚îú‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docs/                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env.example          # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/legion14041981-ui/Legion.git
cd Legion

# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (Windows)
python -m venv venv
.\venv\Scripts\Activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` –≤ `.env`:

```bash
copy .env.example .env
```

2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
import asyncio
from legion import LegionCore
from legion.queue import TaskQueue

async def main():
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Legion
    core = LegionCore()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ Task Queue
    queue = TaskQueue(core.db)
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
    task_id = await queue.add_task(
        task_data={'action': 'process_data', 'payload': 'example'},
        agent_id='agent-1'
    )
    
    print(f"Task {task_id} created")
    
    # –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏
    await queue.start()
    
    # –†–∞–±–æ—Ç–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
    await asyncio.sleep(30)
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
    await queue.stop()

if __name__ == '__main__':
    asyncio.run(main())
```

## üõ†Ô∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### LegionCore

–ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã, —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≥–µ–Ω—Ç–∞–º–∏ –∏ –∏—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º.

```python
from legion import LegionCore, LegionAgent

core = LegionCore()

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
my_agent = MyCustomAgent()
core.register_agent('agent-1', my_agent)

# –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
core.start()
```

### LegionAgent

–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

```python
from legion import LegionAgent

class MyAgent(LegionAgent):
    async def execute(self, task):
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        print(f"Processing task: {task}")
        return {'status': 'completed'}
```

### TaskQueue

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∑–∞–¥–∞—á —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

```python
from legion.queue import TaskQueue

queue = TaskQueue(database)

# –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
task_id = await queue.add_task(
    task_data={'type': 'email', 'to': 'user@example.com'},
    agent_id='email-agent'
)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = queue.get_queue_stats()
print(f"Pending tasks: {stats['pending_count']}")
```

## ‚òÅÔ∏è Supabase Integration

### Edge Functions

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç 2 —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ Edge Functions:

#### 1. process-task

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á (–∑–∞–ø—É—Å–∫/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ).

**Endpoint**: `https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/process-task`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É
curl -X POST 'https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/process-task' \
  -H 'Content-Type: application/json' \
  -d '{
    "task_id": "task-123",
    "agent_id": "agent-1",
    "action": "start"
  }'

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É
curl -X POST 'https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/process-task' \
  -H 'Content-Type: application/json' \
  -d '{
    "task_id": "task-123",
    "agent_id": "agent-1",
    "action": "complete"
  }'
```

#### 2. get-pending-tasks

–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏.

**Endpoint**: `https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/get-pending-tasks`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏
curl 'https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/get-pending-tasks'

# –§–∏–ª—å—Ç—Ä –ø–æ –∞–≥–µ–Ω—Ç—É
curl 'https://hdwvhqxyzcgkrkosbuzk.supabase.co/functions/v1/get-pending-tasks?agent_id=agent-1'
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:

**agents** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–∞—Ö
```sql
CREATE TABLE agents (
    id BIGSERIAL PRIMARY KEY,
    agent_id TEXT UNIQUE NOT NULL,
    name TEXT,
    status TEXT DEFAULT 'Not started',
    webhook_url TEXT,
    last_activity TIMESTAMP WITH TIME ZONE,
    error_count INTEGER DEFAULT 0,
    capabilities JSONB,
    config JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**tasks** - –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
```sql
CREATE TABLE tasks (
    id BIGSERIAL PRIMARY KEY,
    task_id TEXT UNIQUE NOT NULL,
    agent_id TEXT REFERENCES agents(agent_id),
    task_data JSONB,
    status TEXT DEFAULT 'pending',
    result JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    completed_at TIMESTAMP WITH TIME ZONE
);
```

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `supabase>=2.9.0` - Supabase Python –∫–ª–∏–µ–Ω—Ç
- `python-dotenv>=1.0.1` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `httpx>=0.27.0` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è async –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
pytest tests/
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `src/legion/` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
- `tests/` - unit –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `docs/` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `.github/workflows/` - CI/CD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üó∫Ô∏è Roadmap

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤ (EmailAgent, DataAgent)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Supabase Realtime –¥–ª—è live-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets
- [ ] Webhook —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–í–∫–ª–∞–¥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è —Ñ–∏—á–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –ó–∞–ø—É—à—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- GitHub: [@legion14041981-ui](https://github.com/legion14041981-ui)
- Supabase Project: [LEGION](https://supabase.com/dashboard/project/hdwvhqxyzcgkrkosbuzk)

---

**Legion** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –ª–µ–≥–∫–æ üöÄ
